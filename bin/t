#!/usr/bin/env bash

# A command line todo utility
#
# t             List all todo lists
# t -x "item"   Check off the task containing "item"
# t -X "item"   Uncheck the task containing "item"
# t -d "item"   Delete task containing "item"
# t -p          Purge completed tasks
# t -t          Print uncompleted tasks only

if [ -z T_TODO_DIR ]; then
  TODO_DIR="${T_TODO_DIR}"
else
  TODO_DIR="${HOME}"
fi

TODO_FILE="${TODO_DIR}/.todo.txt"

touch "${TODO_FILE}"

while getopts 'x:X:d:pt' opt; do
  case "$opt" in
    x)
      arg="${OPTARG}"
      sed -i'.bak' -e "/${arg}/ s/\[ \]/[*]/" "${TODO_FILE}"
      ;;

    X)
      arg="${OPTARG}"
      sed -i'.bak' -e "/${arg}/ s/\[\*\]/[ ]/" "${TODO_FILE}"
      ;;

    d)
      arg="${OPTARG}"
      sed -i'.bak' "/${arg}/d" "${TODO_FILE}"
      ;;

    p)
      sed -i'.bak' "/\[\*\]/d" "${TODO_FILE}"
      ;;

    t)
      cat "${TODO_FILE}" | grep -e '^\[ \]'
      ;;
  esac
done

if [ $OPTIND -eq 1 ]; then
  [ ${#@} -gt 0 ] && echo "[ ] $@" >> "${TODO_FILE}"
  cat "${TODO_FILE}"
fi

[ -f "${TODO_FILE}.bak" ] && rm "${TODO_FILE}.bak"
